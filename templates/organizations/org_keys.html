{% extends "base.html" %}

{% block title %}Org API Keys{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-8">
  <div class="flex items-center justify-between mb-4">
    <div>
      <h1 class="text-2xl font-semibold">API Keys</h1>
      <div class="text-slate-400 text-sm">{{ org.name }} ({{ org.slug }})</div>
    </div>
    <a class="text-blue-300 hover:text-blue-200 underline" href="/org/settings/keys/">Change org</a>
  </div>

  {% if created_key %}
  <div class="mb-6 bg-slate-800 border border-slate-700 rounded-lg p-4">
    <div class="text-sm text-slate-300 mb-2">New API key (shown once):</div>
    <pre class="bg-slate-900 border border-slate-700 rounded p-3 text-sm overflow-x-auto">{{ created_key }}</pre>
  </div>
  {% endif %}

  {% if can_manage %}
  <form method="post" action="?org={{ org.slug }}" class="mb-6 flex items-center gap-2">
    {% csrf_token %}
    <input type="hidden" name="action" value="create">
    <input type="text" name="name" placeholder="Key name" class="bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm w-64">
    <button type="submit" class="px-3 py-2 rounded bg-slate-700 hover:bg-slate-600">Create</button>
  </form>
  {% else %}
  <div class="mb-6 text-slate-400 text-sm">Only owners/admins can create or deactivate keys.</div>
  {% endif %}

  <div class="bg-slate-800 border border-slate-700 rounded-lg overflow-hidden">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-900">
        <tr class="text-left">
          <th class="px-4 py-2">Prefix</th>
          <th class="px-4 py-2">Name</th>
          <th class="px-4 py-2">Active</th>
          <th class="px-4 py-2">Created</th>
          <th class="px-4 py-2">Last Used</th>
          <th class="px-4 py-2">Requests</th>
          <th class="px-4 py-2">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for key in keys %}
        <tr class="border-t border-slate-700">
          <td class="px-4 py-2">{{ key.key_prefix }}</td>
          <td class="px-4 py-2">{{ key.name }}</td>
          <td class="px-4 py-2">{{ key.is_active }}</td>
          <td class="px-4 py-2">{{ key.created_at }}</td>
          <td class="px-4 py-2">{{ key.last_used_at|default:"-" }}</td>
          <td class="px-4 py-2">{{ key.total_requests }}</td>
          <td class="px-4 py-2">
            {% if can_manage %}
            <form method="post" action="?org={{ org.slug }}">
              {% csrf_token %}
              <input type="hidden" name="action" value="toggle">
              <input type="hidden" name="key_id" value="{{ key.id }}">
              <button type="submit" class="px-3 py-1 rounded bg-slate-700 hover:bg-slate-600">
                {% if key.is_active %}Deactivate{% else %}Activate{% endif %}
              </button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="px-4 py-6 text-center text-slate-400">No API keys yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
